<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Storage Test - Swim Developer Assistant</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f7;
    }
    .test-section {
      background: white;
      padding: 20px;
      margin: 20px 0;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h2 {
      margin-top: 0;
      color: #1d1d1f;
    }
    .test-input {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #d2d2d7;
      border-radius: 8px;
      font-size: 14px;
    }
    .test-button {
      background: #007aff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    .test-button:hover {
      background: #0051d5;
    }
    .test-button.secondary {
      background: #8e8e93;
    }
    .test-button.secondary:hover {
      background: #636366;
    }
    .result {
      background: #f5f5f7;
      padding: 15px;
      margin: 10px 0;
      border-radius: 8px;
      font-family: monospace;
      font-size: 12px;
      white-space: pre-wrap;
      word-break: break-all;
    }
    .success {
      color: #34c759;
      font-weight: bold;
    }
    .error {
      color: #ff3b30;
      font-weight: bold;
    }
    .warning {
      color: #ff9500;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>ğŸ§ª Swim Developer Assistant - Storage Test</h1>
  
  <div class="test-section">
    <h2>1. LocalStorage ê¸°ë³¸ í…ŒìŠ¤íŠ¸</h2>
    <p>ë¸Œë¼ìš°ì €ì˜ LocalStorageê°€ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
    <button class="test-button" onclick="testBasicStorage()">ê¸°ë³¸ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    <div id="basic-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>2. ì•”í˜¸í™”/ë³µí˜¸í™” í…ŒìŠ¤íŠ¸</h2>
    <p>Base64 ì¸ì½”ë”©/ë””ì½”ë”©ì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
    <input type="text" class="test-input" id="encrypt-input" placeholder="í…ŒìŠ¤íŠ¸í•  ë¬¸ìì—´ ì…ë ¥ (ì˜ˆ: AIzaSyABC123...)">
    <button class="test-button" onclick="testEncryption()">ì•”í˜¸í™” í…ŒìŠ¤íŠ¸</button>
    <div id="encrypt-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>3. Settings ì €ì¥/ë¡œë“œ í…ŒìŠ¤íŠ¸</h2>
    <p>ì‹¤ì œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ Storage.Settings ëª¨ë“ˆì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>
    <input type="text" class="test-input" id="gemini-key" placeholder="Gemini API Key">
    <input type="text" class="test-input" id="github-url" placeholder="GitHub Repository URL">
    <button class="test-button" onclick="testSettingsSave()">ì„¤ì • ì €ì¥</button>
    <button class="test-button secondary" onclick="testSettingsLoad()">ì„¤ì • ë¡œë“œ</button>
    <button class="test-button secondary" onclick="testSettingsClear()">ì„¤ì • ì‚­ì œ</button>
    <div id="settings-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>4. LocalStorage ìƒíƒœ í™•ì¸</h2>
    <p>í˜„ì¬ LocalStorageì— ì €ì¥ëœ ëª¨ë“  ë°ì´í„°ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.</p>
    <button class="test-button" onclick="inspectStorage()">ì „ì²´ ì¡°ì‚¬</button>
    <div id="inspect-result" class="result"></div>
  </div>

  <div class="test-section">
    <h2>5. ëª¨ë“ˆ ë¡œë“œ ìƒíƒœ</h2>
    <p>Storage.js ëª¨ë“ˆì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.</p>
    <div id="module-status" class="result"></div>
  </div>

  <script src="js/storage.js"></script>
  <script>
    // Check module load status
    window.addEventListener('DOMContentLoaded', () => {
      const status = document.getElementById('module-status');
      if (typeof Storage !== 'undefined') {
        status.innerHTML = '<span class="success">âœ… Storage ëª¨ë“ˆ ë¡œë“œ ì„±ê³µ</span>\n';
        status.innerHTML += `Settings ë©”ì„œë“œ: ${Object.keys(Storage.Settings).join(', ')}`;
      } else {
        status.innerHTML = '<span class="error">âŒ Storage ëª¨ë“ˆ ë¡œë“œ ì‹¤íŒ¨</span>';
      }
    });

    function testBasicStorage() {
      const result = document.getElementById('basic-result');
      let output = '';
      
      try {
        // Test 1: Simple save/load
        localStorage.setItem('test_key', 'test_value');
        const loaded = localStorage.getItem('test_key');
        
        if (loaded === 'test_value') {
          output += '<span class="success">âœ… Test 1: ê¸°ë³¸ ì €ì¥/ë¡œë“œ ì„±ê³µ</span>\n';
        } else {
          output += '<span class="error">âŒ Test 1: ê¸°ë³¸ ì €ì¥/ë¡œë“œ ì‹¤íŒ¨</span>\n';
          output += `Expected: 'test_value', Got: '${loaded}'\n`;
        }
        
        // Test 2: Remove
        localStorage.removeItem('test_key');
        const removed = localStorage.getItem('test_key');
        
        if (removed === null) {
          output += '<span class="success">âœ… Test 2: ì‚­ì œ ì„±ê³µ</span>\n';
        } else {
          output += '<span class="error">âŒ Test 2: ì‚­ì œ ì‹¤íŒ¨</span>\n';
        }
        
        // Test 3: Quota test (save large data)
        try {
          const largeData = 'x'.repeat(1000000); // 1MB
          localStorage.setItem('test_large', largeData);
          localStorage.removeItem('test_large');
          output += '<span class="success">âœ… Test 3: ëŒ€ìš©ëŸ‰ ì €ì¥ ì„±ê³µ (quota ì¶©ë¶„)</span>\n';
        } catch (e) {
          output += '<span class="warning">âš ï¸  Test 3: ëŒ€ìš©ëŸ‰ ì €ì¥ ì‹¤íŒ¨ (quota ë¶€ì¡± ê°€ëŠ¥ì„±)</span>\n';
          output += `Error: ${e.message}\n`;
        }
        
      } catch (error) {
        output += '<span class="error">âŒ LocalStorage ì‚¬ìš© ë¶ˆê°€</span>\n';
        output += `Error: ${error.message}\n`;
      }
      
      result.innerHTML = output;
    }

    function testEncryption() {
      const result = document.getElementById('encrypt-result');
      const input = document.getElementById('encrypt-input').value;
      let output = '';
      
      if (!input) {
        result.innerHTML = '<span class="warning">âš ï¸  í…ŒìŠ¤íŠ¸í•  ë¬¸ìì—´ì„ ì…ë ¥í•˜ì„¸ìš”</span>';
        return;
      }
      
      try {
        // Test encryption
        const encrypted = btoa(input);
        output += `ì›ë³¸: ${input}\n`;
        output += `ì•”í˜¸í™”: ${encrypted}\n\n`;
        
        // Test decryption
        const decrypted = atob(encrypted);
        
        if (decrypted === input) {
          output += '<span class="success">âœ… ì•”í˜¸í™”/ë³µí˜¸í™” ì„±ê³µ</span>\n';
        } else {
          output += '<span class="error">âŒ ì•”í˜¸í™”/ë³µí˜¸í™” ì‹¤íŒ¨</span>\n';
          output += `Expected: ${input}\n`;
          output += `Got: ${decrypted}\n`;
        }
        
      } catch (error) {
        output += '<span class="error">âŒ ì•”í˜¸í™” ì˜¤ë¥˜</span>\n';
        output += `Error: ${error.message}\n`;
      }
      
      result.innerHTML = output;
    }

    function testSettingsSave() {
      const result = document.getElementById('settings-result');
      const geminiKey = document.getElementById('gemini-key').value;
      const githubUrl = document.getElementById('github-url').value;
      let output = '';
      
      try {
        output += '=== ì €ì¥ ì‹œì‘ ===\n\n';
        
        // Save Gemini API Key
        const geminiSaved = Storage.Settings.saveGeminiApiKey(geminiKey);
        output += `Gemini API Key ì €ì¥: ${geminiSaved ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}\n`;
        output += `ì…ë ¥ê°’: ${geminiKey ? '***' + geminiKey.slice(-4) : '(ë¹„ì–´ìˆìŒ)'}\n\n`;
        
        // Save GitHub URL
        const githubSaved = Storage.Settings.saveGithubRepoUrl(githubUrl);
        output += `GitHub URL ì €ì¥: ${githubSaved ? 'âœ… ì„±ê³µ' : 'âŒ ì‹¤íŒ¨'}\n`;
        output += `ì…ë ¥ê°’: ${githubUrl}\n\n`;
        
        // Immediate verification
        const immediateLoad = Storage.Settings.loadAll();
        output += '=== ì¦‰ì‹œ ê²€ì¦ ===\n';
        output += `Gemini Key: ${immediateLoad.geminiApiKey ? '***' + immediateLoad.geminiApiKey.slice(-4) : '(ì—†ìŒ)'}\n`;
        output += `GitHub URL: ${immediateLoad.githubRepoUrl || '(ì—†ìŒ)'}\n\n`;
        
        if (geminiKey && immediateLoad.geminiApiKey !== geminiKey) {
          output += '<span class="error">âŒ Gemini Key ê²€ì¦ ì‹¤íŒ¨!</span>\n';
        }
        if (githubUrl && immediateLoad.githubRepoUrl !== githubUrl) {
          output += '<span class="error">âŒ GitHub URL ê²€ì¦ ì‹¤íŒ¨!</span>\n';
        }
        
        output += '\n<span class="success">âœ… ì €ì¥ ì™„ë£Œ. "ì„¤ì • ë¡œë“œ" ë²„íŠ¼ì„ ëˆŒëŸ¬ í™•ì¸í•˜ì„¸ìš”.</span>';
        
      } catch (error) {
        output += '<span class="error">âŒ ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</span>\n';
        output += `Error: ${error.message}\n`;
      }
      
      result.innerHTML = output;
    }

    function testSettingsLoad() {
      const result = document.getElementById('settings-result');
      let output = '';
      
      try {
        output += '=== ì„¤ì • ë¡œë“œ ===\n\n';
        
        const settings = Storage.Settings.loadAll();
        
        output += `Gemini API Key: ${settings.geminiApiKey ? '***' + settings.geminiApiKey.slice(-4) : '(ì—†ìŒ)'}\n`;
        output += `GitHub URL: ${settings.githubRepoUrl || '(ì—†ìŒ)'}\n`;
        output += `GitHub Token: ${settings.githubToken ? '***' + settings.githubToken.slice(-4) : '(ì—†ìŒ)'}\n`;
        output += `Collab URL: ${settings.collabGithubRepoUrl || '(ì—†ìŒ)'}\n`;
        output += `Collab Token: ${settings.collabGithubToken ? '***' + settings.collabGithubToken.slice(-4) : '(ì—†ìŒ)'}\n`;
        output += `Theme: ${settings.theme}\n`;
        output += `Font Size: ${settings.fontSize}\n\n`;
        
        // Load into form
        if (settings.geminiApiKey) {
          document.getElementById('gemini-key').value = settings.geminiApiKey;
          output += '<span class="success">âœ… Gemini Keyë¥¼ ì…ë ¥ì°½ì— ë¡œë“œí–ˆìŠµë‹ˆë‹¤</span>\n';
        }
        if (settings.githubRepoUrl) {
          document.getElementById('github-url').value = settings.githubRepoUrl;
          output += '<span class="success">âœ… GitHub URLì„ ì…ë ¥ì°½ì— ë¡œë“œí–ˆìŠµë‹ˆë‹¤</span>\n';
        }
        
      } catch (error) {
        output += '<span class="error">âŒ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</span>\n';
        output += `Error: ${error.message}\n`;
      }
      
      result.innerHTML = output;
    }

    function testSettingsClear() {
      const result = document.getElementById('settings-result');
      let output = '';
      
      if (!confirm('ëª¨ë“  ì„¤ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        return;
      }
      
      try {
        // Clear all swim_dev_assistant keys
        const keys = Object.keys(localStorage);
        const swimKeys = keys.filter(k => k.startsWith('swim_dev_assistant_'));
        
        swimKeys.forEach(key => {
          localStorage.removeItem(key);
          output += `ì‚­ì œ: ${key}\n`;
        });
        
        output += `\n<span class="success">âœ… ${swimKeys.length}ê°œ í•­ëª© ì‚­ì œ ì™„ë£Œ</span>\n`;
        
        // Clear form
        document.getElementById('gemini-key').value = '';
        document.getElementById('github-url').value = '';
        
      } catch (error) {
        output += '<span class="error">âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</span>\n';
        output += `Error: ${error.message}\n`;
      }
      
      result.innerHTML = output;
    }

    function inspectStorage() {
      const result = document.getElementById('inspect-result');
      let output = '';
      
      try {
        output += '=== LocalStorage ì „ì²´ ì¡°ì‚¬ ===\n\n';
        
        const keys = Object.keys(localStorage);
        const swimKeys = keys.filter(k => k.startsWith('swim_dev_assistant_'));
        
        output += `ì „ì²´ í•­ëª© ìˆ˜: ${keys.length}\n`;
        output += `Swim Dev Assistant í•­ëª© ìˆ˜: ${swimKeys.length}\n\n`;
        
        if (swimKeys.length === 0) {
          output += '<span class="warning">âš ï¸  ì €ì¥ëœ ì„¤ì •ì´ ì—†ìŠµë‹ˆë‹¤</span>\n';
        } else {
          swimKeys.forEach(key => {
            const value = localStorage.getItem(key);
            const displayValue = value.length > 50 ? value.substring(0, 50) + '...' : value;
            output += `${key}:\n  ${displayValue}\n\n`;
          });
        }
        
        // Check quota
        let totalSize = 0;
        keys.forEach(key => {
          totalSize += key.length + (localStorage.getItem(key)?.length || 0);
        });
        
        output += `\nì˜ˆìƒ ì‚¬ìš©ëŸ‰: ${(totalSize / 1024).toFixed(2)} KB\n`;
        output += `(ì¼ë°˜ì ì¸ í•œë„: 5-10 MB)\n`;
        
      } catch (error) {
        output += '<span class="error">âŒ ì¡°ì‚¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</span>\n';
        output += `Error: ${error.message}\n`;
      }
      
      result.innerHTML = output;
    }
  </script>
</body>
</html>
